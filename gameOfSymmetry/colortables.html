<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<head>
    <title>colortables</title>
</head>

<body>


</body>



<script type="module">
import {
    ParamGui,
    guiUtils,
    output
}
from "../libgui/modules.js";


const gui = new ParamGui({}, {
    name: "life - controls",
    closed: false
});


output.createCanvas(gui, true);

output.canvas.style.backgroundColor = "lightBlue";

// making color tables
// defined by function (x) x=0...1
// sets color.green .red .blue 

const p={};
p.n=10;

gui.add({type:'number',property:'n',params:p,min:2,onChange: draw})

const sel=gui.add({type:'selection',params:p,property:'generator',onChange: draw})


function greys(color,x){
    color.red=x;
    color.green=x;
    color.blue=x;
}

sel.addOption('greys',greys);

 function draw(){
    console.log(p.generator);
    const canvas = output.canvas;
    const canvasContext = canvas.getContext("2d");
    const imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height);
    const pixels = imageData.data;
    let pixelIndex = 0;
    const height = canvas.height;
    const width = canvas.width;
    var reds,greens,blues;
    [reds,greens,blues]=createTable(p.generator,p.n);
    console.log(reds);

    const color = {};
    for (var jCanvas = 0; jCanvas < height; jCanvas++) {
        for (var iCanvas = 0; iCanvas < width; iCanvas++) {
            const x = iCanvas / width;
const index=Math.floor(iCanvas/width*(p.n-0.00001))
            pixels[pixelIndex] =reds[index];
            pixels[pixelIndex + 1] = greens[index];
            pixels[pixelIndex + 2] = blues[index];
            pixels[pixelIndex + 3] = 255;
            pixelIndex += 4;
        }
    }
    canvasContext.putImageData(imageData, 0, 0);
}

function quantizeColor(color){
               color.red =Math.min(255,Math.max(0, Math.floor(255.9*color.red)));
               color.green =Math.min(255,Math.max(0, Math.floor(255.9*color.green)));
               color.blue =Math.min(255,Math.max(0, Math.floor(255.9*color.blue)));
}

function what(color,x){
	color.red=Math.sqrt(x);
	color.green=x;
	const xs=x*x*x*x*x
	color.blue=4*x*(1-x)+xs*xs*xs;
}

sel.addOption('what',what);


function up(x,xa,xb){
	return (x-xa)/(xb-xa);
}

function down(x,xa,xb){
	return (xb-x)/(xb-xa);
}

function createTable(colorfun,n){
    const color={};
    const reds=[];
    const greens=[];
    const blues=[];
    const d=1/(n-1);
    let x=0;
    for (var i=0;i<n;i++){
        colorfun(color,x);
        quantizeColor(color);
        reds.push(color.red);
        greens.push(color.green);
        blues.push(color.blue);
        x+=d;
    }
    console.log(reds)
    return [reds,greens,blues];
}



output.draw = draw
output.draw();

</script>


</html>