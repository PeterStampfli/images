<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<head>
    <title>test canvas</title>
</head>

<body>

</body>

<script type="module">
import {
    ParamGui,
    output,
    log,
    guiUtils
}
from "../libgui/modules.js";

const gui = new ParamGui({
    name: "dummy controls",
 //   horizontalPosition: "left"
});

gui.add({
        type: "number",
        labelText: "a number",
        initialValue: 1,
        min: 0,
        max: 33
    })
    .createPlusMinusButtons()
    .createMulDivButtons();

// CREATING A LOGGER IN A FOLDER INSIDE THE MAIN UI

const logger = gui.addFolder("logging things").addLogger();

logger.log("a message");
logger.log("another message");
logger.log("I hate double scrollbars");
logger.log("more messages");
logger.log("more messages");
logger.log("more messages");
logger.log("a message");
logger.log("a message");
logger.log("a message");
logger.log("a message");
logger.log("a message");

gui.add({
        type: "number",
        labelText: "another number",
        initialValue: 1,
        min: 0,
        max: 33
    })
    .createPlusMinusButtons(2);

//LOGGING IN AN EXTRA UI, AUTOMATICALLY GENERATED UPON CALLKING THE LOG() METHOD

log("what happens now");
log("what happens now");
log("what happens now");
log("I don't know");
log("what happens now");
log("In an extra gui: only a single scrollbar, at most.");
log("what happens now");
log("what happens now");
log("what happens now");
log("what happens now");
log("what happens now");

/**
 * get the limit for free space at the left
 * taking into account all guis at the left side
 * @method ParamGui#leftSpaceLimit
 * @return number, for the left offset of a fitting container
 */
ParamGui.leftSpaceLimit = function() {
    let spaceLimit = 0;
    ParamGui.rootGuis.forEach(gui => {
        if (gui.design.horizontalPosition === "left") {
            spaceLimit = Math.max(gui.design.horizontalShift + gui.design.width + 2 * gui.design.borderWidth, spaceLimit);
        }
    });
    return spaceLimit;
};


/**
 * get the limit for free space at the right
 * taking into account all guis at the right hand side
 * @method ParamGui#rightSpaceLimit
 * @return number, the width of fitting container is difference between right and left limit
 */
ParamGui.rightSpaceLimit = function() {
    let space = 0;
    ParamGui.rootGuis.forEach(gui => {
        if (gui.design.horizontalPosition === "right") {
            space = Math.max(gui.design.horizontalShift + gui.design.width + 2 * gui.design.borderWidth, space);
        }
    });
    // with window.innerWidth we do not get some ghosts of scroll bars
    // document.documentElement.clientWidth upon reducing screen height gives a smaller width because of spurious vertical scroll bar
    const spaceLimit = window.innerWidth - space;
    return spaceLimit;
};


ParamGui.outputDiv = false;

/**
* resizing the content of the output div
* does nothing here, overwrite depending on content
* output div will have its final dimension when calling this
* so you can use its clientWidth/Height
* @method ParamGui.resizeOutputContent
*/
ParamGui.resizeOutputContent=function(){};

/**
 * resizing the output div and setting its scrolling
 * sets width and height of the output div
 * calls resize function for contents
 * determines size of content
 * then activates scroll bars
 * @method ParamGui.resizeOutputDiv
 */
ParamGui.resizeOutputDiv = function() {
    const leftOfSpace = ParamGui.leftSpaceLimit();
    const widthOfSpace = ParamGui.rightSpaceLimit() - leftOfSpace;
    console.log("leftspace "+leftOfSpace);
    console.log("rightspace "+ParamGui.rightSpaceLimit() );
    ParamGui.outputDiv.style.left = leftOfSpace + "px";
    // resize content: set up dimensions of the div
    ParamGui.outputDiv.style.width = widthOfSpace + "px";
    ParamGui.outputDiv.style.height = window.innerHeight + "px";
    ParamGui.outputDiv.style.overflowX = "hidden";
    ParamGui.outputDiv.style.overflowY = "hidden";
    ParamGui.resizeOutputContent();
    // get size of contents
    // no height and width given => shrink wrap
    ParamGui.outputDiv.style.height = "";
    ParamGui.outputDiv.style.width = "";
    // clientWidth/Height give dimensions of content
    const widthOfContent = ParamGui.outputDiv.clientWidth;
    const heightOfContent = ParamGui.outputDiv.clientHeight;
    console.log("widthOfContent " + widthOfContent);
    console.log("heightOfContent " + heightOfContent);
    // set final dimensions
    ParamGui.outputDiv.style.width = widthOfSpace + "px";
    console.log("widthOfSpace "+widthOfSpace);
    console.log("style width "+ParamGui.outputDiv.style.width);
        ParamGui.outputDiv.style.height = window.innerHeight + "px";
    console.log("clientWidth " + ParamGui.outputDiv.clientWidth);
    console.log("offsetWidth "+ParamGui.outputDiv.offsetWidth);
    // see if content is too wide and horizontal scroll bars are required
    if (widthOfContent > ParamGui.outputDiv.clientWidth) {
        ParamGui.outputDiv.style.overflowX = "scroll";
        console.log("first time hor scroll bars");
    }
    // see if content is too high (including a possible scroll bar)
    console.log("clientHeight " + ParamGui.outputDiv.clientHeight);
    if (heightOfContent > ParamGui.outputDiv.clientHeight) {
        ParamGui.outputDiv.style.overflowY = "scroll";
        console.log("vertical scroll bars");
        console.log("clientWidth " + ParamGui.outputDiv.clientWidth);
        // the clientwidth has been reduced, and we may need a herizontal scroll bar now
        if (widthOfContent > ParamGui.outputDiv.clientWidth) {
            ParamGui.outputDiv.style.overflowX = "scroll";
            console.log("second time hor scroll bars");
        }
    }
};

/**
 * create an output div fitting the guis
 * it will be in ParamGui.outputDiv
 * it will fit between the guis at the left and those at the right
 * you can have more than one canvas in the output div ...
 * @method ParamGui.createOutputDiv
 * @return the output div
 */
ParamGui.createOutputDiv = function() {
    if (ParamGui.outputDiv) {
        console.error("ParamGui.outputDiv exists already!");
    } else {
        ParamGui.outputDiv = document.createElement("div");
        ParamGui.outputDiv.style.position = "absolute";
        ParamGui.outputDiv.style.top = "0px";

        ParamGui.outputDiv.style.backgroundColor = "blue";

        ParamGui.resizeOutputDiv();
        document.body.appendChild(ParamGui.outputDiv);
        window.addEventListener("resize", ParamGui.resizeOutputDiv, false);
    }
    return ParamGui.outputDiv;

};
ParamGui.createOutputDiv();

const theDiv=document.createElement("div");
ParamGui.outputDiv.appendChild(theDiv);
theDiv.style.borderStyle="solid";
theDiv.style.width="700px";
theDiv.style.height="400px";
theDiv.style.backgroundColor="yellow";

ParamGui.resizeOutputDiv();


console.log(ParamGui.leftSpaceLimit());
console.log(ParamGui.rightSpaceLimit());
</script>
</html>