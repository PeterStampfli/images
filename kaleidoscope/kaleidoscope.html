
<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<head>
    <title> kaleidoscope in progress</title>
</head>

<body>
</body>

<script type='module'>

import {
    CoordinateTransform,
    Pixels,
    ParamGui,
    output,
    map,
    guiUtils
} from "../libgui/modules.js";

import {
    Circle,
    mirrors
} from './modules.js';

// basic setup
const gui=new ParamGui({name:'test',closed:false});

// an output canvas and some test image
const outputGui=gui.addFolder('output image');
output.createCanvas(outputGui);
output.createPixels();
const canvas = output.canvas;
const canvasContext = output.canvasContext;
outputGui.addParagraph('coordinate transform');
output.addCoordinateTransform(outputGui, false);
output.setInitialCoordinates(0, 0, 3);
map.setOutputDraw();
const inputGui=gui.addFolder('input image');
map.inputImage = '../libgui/testimage.jpg';
map.setupInputImage(inputGui);
const regionGui=gui.addFolder('regions');

map.regionControl(regionGui, 2);

map.makeNewColorTable(regionGui, 2);

// setup mapping show structure
map.mapping = function(point) {
    let x = point.x - Math.floor(point.x);
    if (x > 0.5) {
        x = 1 - x;
        point.structureIndex++;
    }
    let y = point.y - Math.floor(point.y);
    if (y > 0.5) {
        y = 1 - y;
        point.structureIndex++;
    }
    if (x > y) {
        const h = x;
        x = y;
        y = h;
        point.structureIndex++;
    }
    point.x = x;
    point.y = y;
};


gui.addParagraph('circle 1')

const circle=new Circle(gui);


circle.setRadius(0.5);
circle.setCenter(0,0);
circle.setIsOutsideInMap(true)
circle.setIsOutsideInMap(false)
mirrors.add(circle)

gui.addParagraph('circle 2')

const circle2=new Circle(gui);


circle2.setRadius(0.75);
circle2.setCenter(0,-1);

mirrors.add(circle2)


map.drawImageChanged = function() {
map.draw();
    mirrors.draw()
}
Circle.draw=map.drawImageChanged;

output.mouseCtrlMoveAction=function(event){
    if (mirrors.isSelected(event)){
            output.canvas.style.cursor = "pointer";
    } else {
                    output.canvas.style.cursor = "default";
    }
    output.pixels.show();
    mirrors.draw(false);
};

output.mouseCtrlDownAction=function(event){
    mirrors.select(event);
    output.pixels.show();
    mirrors.draw(false);
};

output.mouseCtrlDragAction=function(event){
    circle.dragAction(event);
    map.drawImageChanged();
};




output.mouseCtrlWheelAction=function(event){
    mirrors.wheelAction(event);
    map.drawImageChanged();
};

output.mouseCtrlDragAction=function(event){
    mirrors.dragAction(event);
    map.drawImageChanged();
};

output.firstDrawing();


</script>

</html>